<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kişiye Özel Tarla Deneyimi - İnteraktif İş Planı</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Earthy Harmony -->
    <!-- Application Structure Plan: The application is designed as a single-page, scrollable narrative. It starts with a strong hero section to grab attention, followed by a clear navigation bar for easy access to different parts of the plan. The structure is thematic, not linear like the report: 1. "Nasıl Çalışır?" uses an interactive step-by-step diagram. 2. "Paketler" uses a tabbed interface for quick comparison and introduces AI-powered recipe suggestions based on selected packages. 3. "Size Özel Bir Paket Oluşturalım mı?" section allows users to describe their needs and get an AI-generated custom package suggestion. 4. "Finansal Analiz" features interactive charts to explore cost and profit scenarios. 5. "Deneyim" showcases the unique value propositions in a visually appealing grid. 6. "Hukuki Çerçeve" uses an accordion to make dense legal text manageable. This structure guides the user from the core concept to the details in an engaging and non-overwhelming way, prioritizing understanding and exploration over static reading, with new AI features enhancing personalization and utility. -->
    <!-- Visualization & Content Choices: 
    - Report Info: Financial numbers (cost, price). Goal: Compare & Inform. Viz: Interactive Bar & Donut Charts. Interaction: Toggles for min/max scenarios update charts. Justification: Dynamic charts make financial data more engaging and easier to digest than static numbers. Library: Chart.js (Canvas).
    - Report Info: How it works. Goal: Organize & Inform. Viz: Numbered step-by-step flow diagram. Interaction: Hover effects on steps. Justification: A visual flow is more intuitive than a block of text for explaining a process. Method: HTML/CSS/Tailwind.
    - Report Info: Package types. Goal: Compare. Viz: Tabbed content area + AI Recipe Suggestion. Interaction: Clicking tabs reveals package details, a button triggers an LLM call for a recipe based on the package. Justification: Tabs allow for direct comparison, and AI recipes add immediate value and interactivity. Method: HTML/JS, Chart.js (Canvas), Gemini API.
    - Report Info: Custom Package Suggestion. Goal: Inform & Personalize. Viz: Text input and display area. Interaction: User types needs, button triggers LLM call for custom package suggestion. Justification: Directly addresses user's potential desire for tailored options, showcasing AI's personalization capabilities. Method: HTML/JS, Gemini API.
    - Report Info: Legal framework. Goal: Organize. Viz: Accordion component. Interaction: Clicking to expand/collapse sections. Justification: Hides complexity and allows users to focus on one legal topic at a time. Method: HTML/JS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }
        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active, .nav-link:hover {
            color: #2C5F2D;
            border-bottom-color: #2C5F2D;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .tab-btn.active {
            background-color: #2C5F2D;
            color: #FFFFFF;
        }
        .accordion-header.active .accordion-icon {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="antialiased">

    <header id="header" class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-xl font-bold text-[#2C5F2D]">Tohumdan Sofraya</a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#nasil-calisir" class="nav-link pb-1">Nasıl Çalışır?</a>
                <a href="#paketler" class="nav-link pb-1">Paketler</a>
                <a href="#ozel-paket" class="nav-link pb-1">Özel Paket</a>
                <a href="#finansal-analiz" class="nav-link pb-1">Finansal Analiz</a>
                <a href="#deneyim" class="nav-link pb-1">Deneyim</a>
                <a href="#hukuki-cerceve" class="nav-link pb-1">Hukuki Çerçeve</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-2xl">☰</button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4 flex flex-col space-y-4">
            <a href="#nasil-calisir" class="nav-link text-center">Nasıl Çalışır?</a>
            <a href="#paketler" class="nav-link text-center">Paketler</a>
            <a href="#ozel-paket" class="nav-link text-center">Özel Paket</a>
            <a href="#finansal-analiz" class="nav-link text-center">Finansal Analiz</a>
            <a href="#deneyim" class="nav-link text-center">Deneyim</a>
            <a href="#hukuki-cerceve" class="nav-link text-center">Hukuki Çerçeve</a>
        </div>
    </header>

    <main>
        <section id="hero" class="py-20 md:py-32 bg-green-50/50">
            <div class="container mx-auto px-6 text-center">
                <h1 class="text-4xl md:text-6xl font-bold text-[#2C5F2D] mb-4">Bu Sadece Sebze Değil, Sizin Hikayeniz.</h1>
                <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">Edirne'deki tarlamızda, adınıza özel bir parselde sizin için en taze ürünleri yetiştiriyor, hasat ediyor ve kapınıza kadar gönderiyoruz. Kendi çiftliğinizin keyfini çıkarın, tırmık tutmadan.</p>
            </div>
        </section>

        <section id="nasil-calisir" class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Süreç Nasıl İşliyor?</h2>
                    <p class="mt-4 text-gray-600 max-w-2xl mx-auto">Dört basit adımda tohumdan sofranıza uzanan taptaze bir deneyim sizi bekliyor. Her adımı şeffaf bir şekilde takip edebilir, sürecin bir parçası olabilirsiniz.</p>
                </div>
                <div class="grid md:grid-cols-4 gap-8 text-center">
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300">
                        <div class="text-4xl text-[#2C5F2D] mb-4">①</div>
                        <h3 class="text-xl font-semibold mb-2">Parselini Seç</h3>
                        <p class="text-gray-500">Size uygun paketi ve parsel büyüklüğünü seçerek maceranıza ilk adımı atın.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300">
                        <div class="text-4xl text-[#2C5F2D] mb-4">②</div>
                        <h3 class="text-xl font-semibold mb-2">Biz Ekelim</h3>
                        <p class="text-gray-500">Seçtiğiniz ürünleri uzman ekibimiz sizin için özenle eker ve bakımını yapar.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300">
                        <div class="text-4xl text-[#2C5F2D] mb-4">③</div>
                        <h3 class="text-xl font-semibold mb-2">Büyümesini İzle</h3>
                        <p class="text-gray-500">Uygulamamız üzerinden parselinizi canlı izleyin, ürünlerinizin büyüme günlüğünü takip edin.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300">
                        <div class="text-4xl text-[#2C5F2D] mb-4">④</div>
                        <h3 class="text-xl font-semibold mb-2">Tazecik Gelsin</h3>
                        <p class="text-gray-500">Hasat edilen taptaze ürünlerinizi soğuk zincir ile haftalık olarak kapınıza teslim edelim.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="paketler" class="py-16 md:py-24 bg-green-50/50">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Size Özel Sezon Paketleri</h2>
                    <p class="mt-4 text-gray-600 max-w-2xl mx-auto">Farklı ihtiyaç ve zevklere göre özenle hazırladığımız sezonluk paketlerimizden birini seçin. Dilerseniz ufak değişiklikler yapabilirsiniz.</p>
                </div>
                <div>
                    <div class="flex justify-center mb-8 border-b border-gray-200">
                        <button class="tab-btn py-3 px-6 text-lg font-medium text-gray-500 transition-colors duration-300 active" data-tab="aile" data-ingredients="domates, salatalık, biber, marul, maydanoz, patates, soğan">Aile Sezonu</button>
                        <button class="tab-btn py-3 px-6 text-lg font-medium text-gray-500 transition-colors duration-300" data-tab="gurme" data-ingredients="heirloom domates, mini biberler, taze fesleğen, kekik, roka">Gurme</button>
                        <button class="tab-btn py-3 px-6 text-lg font-medium text-gray-500 transition-colors duration-300" data-tab="detoks" data-ingredients="yeşil yapraklılar, havuç, pancar, brokoli, salatalık, dereotu">Detoks/Bebek</button>
                    </div>
                    <div id="tab-content" class="max-w-4xl mx-auto">
                        <div id="aile" class="tab-pane">
                            <div class="bg-white p-8 rounded-lg shadow-md flex flex-col md:flex-row items-center gap-8">
                                <div class="text-5xl">👨‍👩‍👧‍👦</div>
                                <div>
                                    <h3 class="text-2xl font-bold text-[#2C5F2D] mb-2">Aile Sezonu Paketi</h3>
                                    <p class="text-gray-600 mb-4">Sofraların vazgeçilmezi temel sebzeler. Domates, salatalık, biber, taze yeşillikler ve kök sebzelerle dolu, tüm ailenin seveceği bir paket.</p>
                                    <p class="font-semibold text-gray-700">Hedef Kitle: Sağlıklı beslenmeye önem veren aileler.</p>
                                </div>
                            </div>
                        </div>
                        <div id="gurme" class="tab-pane hidden">
                            <div class="bg-white p-8 rounded-lg shadow-md flex flex-col md:flex-row items-center gap-8">
                                <div class="text-5xl">🧑‍🍳</div>
                                <div>
                                    <h3 class="text-2xl font-bold text-[#2C5F2D] mb-2">Gurme Paketi</h3>
                                    <p class="text-gray-600 mb-4">Mutfakta harikalar yaratmayı sevenler için. Heirloom domatesler, aromatik biberler, özel taze otlar ve şeflerin favorisi diğer lezzetler.</p>
                                    <p class="font-semibold text-gray-700">Hedef Kitle: Butik restoranlar, şefler ve yemek tutkunları.</p>
                                </div>
                            </div>
                        </div>
                        <div id="detoks" class="tab-pane hidden">
                            <div class="bg-white p-8 rounded-lg shadow-md flex flex-col md:flex-row items-center gap-8">
                                <div class="text-5xl">🧘‍♀️</div>
                                <div>
                                    <h3 class="text-2xl font-bold text-[#2C5F2D] mb-2">Detoks/Bebek Paketi</h3>
                                    <p class="text-gray-600 mb-4">Hafif ve besleyici seçenekler. Bolca yeşillik, havuç, pancar, brokoli gibi vitamin deposu, pestisitsiz ürünler.</p>
                                    <p class="font-semibold text-gray-700">Hedef Kitle: Sağlık ve spor odaklı bireyler, bebekli aileler.</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-8 p-6 bg-white rounded-lg shadow-md">
                            <h3 class="text-xl font-semibold text-[#2C5F2D] mb-4">✨ Bu Paketle Ne Pişirebilirim?</h3>
                            <p class="text-gray-600 mb-4">Seçtiğiniz paketteki ürünlerle hazırlanabilecek pratik ve lezzetli tarif önerileri alın!</p>
                            <button id="get-recipe-btn" class="bg-[#2C5F2D] text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors duration-300">✨ Tarif Oluştur</button>
                            <div id="recipe-output" class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 min-h-[100px] text-gray-700 whitespace-pre-wrap">Burada tarifiniz belirecek...</div>
                            <div id="recipe-loading" class="hidden text-center mt-4">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-[#2C5F2D] mx-auto"></div>
                                <p class="text-gray-500">Tarif yükleniyor...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="ozel-paket" class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800">✨ Size Özel Bir Paket Oluşturalım mı?</h2>
                    <p class="mt-4 text-gray-600 max-w-2xl mx-auto">Ailenizin büyüklüğünü, diyet tercihlerinizi, sevdiğiniz veya sevmediğiniz sebzeleri bize anlatın, size özel bir ürün paketi oluşturalım.</p>
                </div>
                <div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-md">
                    <textarea id="package-prompt" class="w-full p-3 border border-gray-300 rounded-lg mb-4 h-32 focus:outline-none focus:ring-2 focus:ring-[#2C5F2D]" placeholder="Örn: 4 kişilik bir aileyiz, çocuklar biber sevmez ama domatese bayılır. Annem glutensiz besleniyor, babam sporcu."></textarea>
                    <button id="get-package-suggestion-btn" class="bg-[#2C5F2D] text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors duration-300">✨ Paket Önerisi Al</button>
                    <div id="package-suggestion-output" class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 min-h-[100px] text-gray-700 whitespace-pre-wrap">Burada paket öneriniz belirecek...</div>
                    <div id="package-suggestion-loading" class="hidden text-center mt-4">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-[#2C5F2D] mx-auto"></div>
                        <p class="text-gray-500">Paket önerisi yükleniyor...</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="finansal-analiz" class="py-16 md:py-24 bg-green-50/50">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Finansal Analiz: Rakamlarla Değer</h2>
                    <p class="mt-4 text-gray-600 max-w-2xl mx-auto">İş modelimizin finansal potansiyelini interaktif grafiklerle keşfedin. Kutu başına maliyet, fiyatlandırma ve kâr marjı senaryolarını inceleyin.</p>
                </div>
                <div class="flex justify-center mb-8">
                    <div class="bg-gray-200 p-1 rounded-full flex items-center">
                        <button id="scenario-min" class="px-4 py-2 text-sm font-semibold rounded-full bg-white text-[#2C5F2D] shadow">Minimum Senaryo</button>
                        <button id="scenario-max" class="px-4 py-2 text-sm font-semibold rounded-full">Maksimum Senaryo</button>
                    </div>
                </div>
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div>
                        <h3 class="text-xl font-semibold text-center mb-4">Kutu Başına Fiyat vs. Maliyet</h3>
                        <div class="chart-container">
                            <canvas id="profitChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-center mb-4">Maliyet Dağılımı</h3>
                        <div class="chart-container">
                            <canvas id="costChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="deneyim" class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Deneyimi Mükemmelleştirmek</h2>
                    <p class="mt-4 text-gray-600 max-w-2xl mx-auto">Sadece ürün değil, unutulmaz bir deneyim sunuyoruz. Müşteri kendini çiftçi gibi hisseder ama tırmık tutmaz.</p>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="font-semibold text-lg text-[#2C5F2D] mb-2">🌿 Kişisel İsimlendirme</h3>
                        <p class="text-gray-600">Parsellere numara yerine "Ayşe Hanım'ın Domates Bahçesi" gibi özel isimler veriyoruz.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="font-semibold text-lg text-[#2C5F2D] mb-2">📹 Canlı Kamera</h3>
                        <p class="text-gray-600">Uygulamadan parselinizi 7/24 canlı izleyerek ürünlerinizin büyümesine tanıklık edin.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="font-semibold text-lg text-[#2C5F2D] mb-2">📝 Ekim Günlüğü</h3>
                        <p class="text-gray-600">Ekimden hasada kadar tüm süreci fotoğraflı "büyüme günlüğü" ile takip edin.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="font-semibold text-lg text-[#2C5F2D] mb-2">🎁 Kişisel Dokunuş</h3>
                        <p class="text-gray-600">Her kutuya "Bu hafta domatesler güneşi bol gördü" gibi size özel notlar ekliyoruz.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="font-semibold text-lg text-[#2C5F2D] mb-2">🎉 VIP Deneyimler</h3>
                        <p class="text-gray-600">Hasat günü davetleri ve çocuklar için tohum ekme atölyeleri gibi özel etkinlikler düzenliyoruz.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="font-semibold text-lg text-[#2C5F2D] mb-2">🤝 Topluluk Hissi</h3>
                        <p class="text-gray-600">"Parselseverler" grubumuzda diğer üyelerle tanışın, deneyimlerinizi paylaşın.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="hukuki-cerceve" class="py-16 md:py-24 bg-green-50/50">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Hukuki Çerçeve ve Güvence</h2>
                    <p class="mt-4 text-gray-600 max-w-2xl mx-auto">İş modelimiz, hem sizi hem de bizi koruyan sağlam bir hukuki zemin üzerine kurulmuştur. Karmaşık yasal bilgileri anlaşılır başlıklar altında topladık.</p>
                </div>
                <div class="max-w-3xl mx-auto space-y-4">
                    <div class="accordion-item bg-white rounded-lg shadow-sm">
                        <button class="accordion-header w-full flex justify-between items-center p-5 text-left font-semibold text-gray-700">
                            Modelin Hukuki Niteliği
                            <span class="accordion-icon transition-transform duration-300">▼</span>
                        </button>
                        <div class="accordion-content overflow-hidden max-h-0 transition-all duration-500 ease-in-out">
                            <p class="p-5 pt-0 text-gray-600">Bu bir toprak mülkiyeti devri veya kiralama değil, bir **hizmet ve ürün sağlama sözleşmesidir**. Müşteri, parselin mülkiyetini değil, o parselde üretilen ürünlerin sezonluk hakkını satın alır. Bu nedenle tapu/kadastro mevzuatına girmez.</p>
                        </div>
                    </div>
                    <div class="accordion-item bg-white rounded-lg shadow-sm">
                        <button class="accordion-header w-full flex justify-between items-center p-5 text-left font-semibold text-gray-700">
                            Kritik Yasal Belgeler
                            <span class="accordion-icon transition-transform duration-300">▼</span>
                        </button>
                        <div class="accordion-content overflow-hidden max-h-0 transition-all duration-500 ease-in-out">
                            <ul class="p-5 pt-0 text-gray-600 list-disc list-inside space-y-2">
                                <li>**Sezonluk Üretim ve Teslim Sözleşmesi:** Parselin sembolik tanımını, riskleri ve politikaları içerir.</li>
                                <li>**Mesafeli Satış Sözleşmesi:** Online siparişler için zorunludur, cayma hakkı istisnasını belirtir.</li>
                                <li>**KVKK Aydınlatma Metni:** Müşteri verilerinin işlenmesi ve kamera görüntüleri için gereklidir.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="accordion-item bg-white rounded-lg shadow-sm">
                        <button class="accordion-header w-full flex justify-between items-center p-5 text-left font-semibold text-gray-700">
                            Dikkat Edilmesi Gerekenler
                            <span class="accordion-icon transition-transform duration-300">▼</span>
                        </button>
                        <div class="accordion-content overflow-hidden max-h-0 transition-all duration-500 ease-in-out">
                             <ul class="p-5 pt-0 text-gray-600 list-disc list-inside space-y-2">
                                <li>"Kiralama" yerine **"sezonluk tahsis"** gibi ifadeler kullanılmalıdır.</li>
                                <li>**Sertifikasız "organik" kelimesi kullanılmamalıdır.** "İyi Tarım Uygulamaları" ile başlanabilir.</li>
                                <li>Her teslimatta parti no, hasat tarihi gibi bilgiler yer almalıdır.</li>
                                <li>Doğal afetlere karşı **TARSİM sigortası** yaptırılmalıdır.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 Tohumdan Sofraya. Tüm hakları saklıdır.</p>
            <p class="text-sm text-gray-400 mt-2">Bu interaktif iş planı, bir iş fikrini sunmak amacıyla oluşturulmuştur.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
    });

    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('main section');
    const headerHeight = document.getElementById('header').offsetHeight;

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').substring(1) === entry.target.id) {
                        link.classList.add('active');
                    }
                });
            }
        });
    }, { rootMargin: `-${headerHeight}px 0px 0px 0px`, threshold: 0.4 });

    sections.forEach(section => {
        observer.observe(section);
    });
    
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabPanes = document.querySelectorAll('.tab-pane');
    const getRecipeBtn = document.getElementById('get-recipe-btn');
    const recipeOutput = document.getElementById('recipe-output');
    const recipeLoading = document.getElementById('recipe-loading');

    let currentIngredients = document.querySelector('.tab-btn.active').getAttribute('data-ingredients');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            tabButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            const targetTab = button.getAttribute('data-tab');
            currentIngredients = button.getAttribute('data-ingredients');
            
            tabPanes.forEach(pane => {
                if (pane.id === targetTab) {
                    pane.classList.remove('hidden');
                } else {
                    pane.classList.add('hidden');
                }
            });
            recipeOutput.textContent = 'Burada tarifiniz belirecek...';
        });
    });

    getRecipeBtn.addEventListener('click', async () => {
        recipeOutput.textContent = '';
        recipeLoading.classList.remove('hidden');
        const prompt = `${currentIngredients} içeren, aileye uygun, pratik bir yemek tarifi önerir misin?`;
        const recipe = await callGeminiAPI(prompt);
        recipeOutput.textContent = recipe;
        recipeLoading.classList.add('hidden');
    });

    const packagePromptInput = document.getElementById('package-prompt');
    const getPackageSuggestionBtn = document.getElementById('get-package-suggestion-btn');
    const packageSuggestionOutput = document.getElementById('package-suggestion-output');
    const packageSuggestionLoading = document.getElementById('package-suggestion-loading');

    getPackageSuggestionBtn.addEventListener('click', async () => {
        const userDescription = packagePromptInput.value.trim();
        if (!userDescription) {
            packageSuggestionOutput.textContent = 'Lütfen ihtiyaçlarınızı girin.';
            return;
        }

        packageSuggestionOutput.textContent = '';
        packageSuggestionLoading.classList.remove('hidden');
        const prompt = `Şu açıklamaya göre kişiye özel bir sebze paketi önerisi hazırla: "${userDescription}". Önerinde paketin içeriğini ve neden bu kişilere uygun olduğunu belirt.`;
        const suggestion = await callGeminiAPI(prompt);
        packageSuggestionOutput.textContent = suggestion;
        packageSuggestionLoading.classList.add('hidden');
    });

    const accordionHeaders = document.querySelectorAll('.accordion-header');
    accordionHeaders.forEach(header => {
        header.addEventListener('click', () => {
            const content = header.nextElementSibling;
            header.classList.toggle('active');
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });
    });

    const financialData = {
        min: {
            price: 800,
            cost: 475,
            costBreakdown: {
                labels: ['Lojistik', 'Paketleme', 'İşçilik', 'Üretim'],
                data: [180, 35, 120, 140],
            }
        },
        max: {
            price: 1100,
            cost: 695,
            costBreakdown: {
                labels: ['Lojistik', 'Paketleme', 'İşçilik', 'Üretim'],
                data: [260, 55, 160, 220],
            }
        }
    };

    const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        return `${context.label}: ${context.raw.toLocaleString('tr-TR')} TL`;
                    }
                }
            }
        }
    };

    const profitCtx = document.getElementById('profitChart').getContext('2d');
    const profitChart = new Chart(profitCtx, {
        type: 'bar',
        data: {
            labels: ['Senaryo'],
            datasets: [
                {
                    label: 'Maliyet',
                    data: [financialData.min.cost],
                    backgroundColor: '#FFB3B3',
                    borderColor: '#FF8080',
                    borderWidth: 1
                },
                {
                    label: 'Fiyat',
                    data: [financialData.min.price],
                    backgroundColor: '#C1E1C1',
                    borderColor: '#90EE90',
                    borderWidth: 1
                }
            ]
        },
        options: { ...chartOptions, scales: { y: { beginAtZero: true, ticks: { callback: value => `${value} TL` } } } }
    });

    const costCtx = document.getElementById('costChart').getContext('2d');
    const costChart = new Chart(costCtx, {
        type: 'doughnut',
        data: {
            labels: financialData.min.costBreakdown.labels,
            datasets: [{
                data: financialData.min.costBreakdown.data,
                backgroundColor: ['#FFC3A0', '#FFDAB9', '#FFFACD', '#E6E6FA'],
                hoverOffset: 4
            }]
        },
        options: chartOptions
    });

    const scenarioMinBtn = document.getElementById('scenario-min');
    const scenarioMaxBtn = document.getElementById('scenario-max');

    function updateCharts(scenario) {
        profitChart.data.datasets[0].data = [financialData[scenario].cost];
        profitChart.data.datasets[1].data = [financialData[scenario].price];
        profitChart.update();

        costChart.data.datasets[0].data = financialData[scenario].costBreakdown.data;
        costChart.update();
    }

    scenarioMinBtn.addEventListener('click', () => {
        updateCharts('min');
        scenarioMinBtn.classList.add('bg-white', 'text-[#2C5F2D]', 'shadow');
        scenarioMaxBtn.classList.remove('bg-white', 'text-[#2C5F2D]', 'shadow');
    });

    scenarioMaxBtn.addEventListener('click', () => {
        updateCharts('max');
        scenarioMaxBtn.classList.add('bg-white', 'text-[#2C5F2D]', 'shadow');
        scenarioMinBtn.classList.remove('bg-white', 'text-[#2C5F2D]', 'shadow');
    });

    async function callGeminiAPI(prompt) {
        let chatHistory = [];
        chatHistory.push({ role: "user", parts: [{ text: prompt }] });
        const payload = { contents: chatHistory };
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        let response;
        let result;
        let retries = 0;
        const maxRetries = 3;
        const baseDelay = 1000;

        while (retries < maxRetries) {
            try {
                response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                result = await response.json();

                if (response.ok) {
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        console.error("Gemini API'den beklenen yanıt yapısı gelmedi:", result);
                        return "Üzgünüm, bir sorun oluştu. Lütfen tekrar deneyin.";
                    }
                } else if (response.status === 429) {
                    retries++;
                    const delay = baseDelay * Math.pow(2, retries - 1);
                    await new Promise(resolve => setTimeout(resolve, delay));
                } else {
                    console.error(`Gemini API hatası: ${response.status} - ${response.statusText}`, result);
                    return "Üzgünüm, bir sorun oluştu. Lütfen tekrar deneyin.";
                }
            } catch (error) {
                console.error("Gemini API çağrılırken bir hata oluştu:", error);
                return "Üzgünüm, bir sorun oluştu. Lütfen tekrar deneyin.";
            }
        }
        return "API çağrısı çok fazla denemeden sonra başarısız oldu. Lütfen daha sonra tekrar deneyin.";
    }
});
</script>

</body>
</html>
